// Prisma Schema for Saree4ever E-commerce Platform
// This schema matches the database tables created in Supabase

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  schemas  = ["public"]
  // URL is configured in prisma.config.ts
}

// ============================================
// PRODUCT CATALOG
// ============================================

model Collection {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String   @unique @db.Text
  slug          String   @unique @db.Text
  description   String?  @db.Text
  image_url     String?  @db.Text
  is_active     Boolean  @default(true)
  display_order Int      @default(0)
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @default(now()) @db.Timestamptz(6)

  products            Product[] // Keeping backward compatibility for now
  product_collections ProductCollection[]

  @@index([is_active])
  @@index([display_order])
  @@map("collections")
  @@schema("public")
}

model Category {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String   @unique @db.Text
  slug          String   @unique @db.Text
  description   String?  @db.Text
  image_url     String?  @db.Text
  is_active     Boolean  @default(true)
  display_order Int      @default(0)
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @default(now()) @db.Timestamptz(6)

  products           Product[] // Keeping backward compatibility
  product_categories ProductCategory[]

  @@index([is_active])
  @@index([display_order])
  @@map("categories")
  @@schema("public")
}

model Type {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String   @unique @db.Text
  slug          String   @unique @db.Text
  description   String?  @db.Text
  image_url     String?  @db.Text
  is_active     Boolean  @default(true)
  display_order Int      @default(0)
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @default(now()) @db.Timestamptz(6)

  products      Product[] // Keeping backward compatibility
  product_types ProductType[]

  @@index([is_active])
  @@index([display_order])
  @@map("types")
  @@schema("public")
}

model Product {
  id                String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String   @db.Text
  slug              String   @unique @db.Text
  description       String?  @db.Text
  long_description  String?  @db.Text
  collection_id     String?  @db.Uuid
  category_id       String?  @db.Uuid
  type_id           String?  @db.Uuid
  base_price        Decimal  @db.Decimal(10, 2)
  compare_at_price  Decimal? @db.Decimal(10, 2)
  mrp               Decimal? @db.Decimal(10, 2)
  primary_image_url String?  @db.Text
  image_urls        String[] @default([])
  sku               String?  @unique @db.Text
  tags              String[] @default([])
  is_featured       Boolean  @default(false)
  is_active         Boolean  @default(true)
  display_order     Int      @default(0)
  meta_title        String?  @db.Text
  meta_description  String?  @db.Text
  created_at        DateTime @default(now()) @db.Timestamptz(6)
  updated_at        DateTime @default(now()) @db.Timestamptz(6)

  // Taxonomy fields
  color           String?  @db.Text
  weave           String?  @db.Text
  length_m        Decimal? @db.Decimal(4, 2)
  blouse_included Boolean  @default(false)
  subcategories   String[] @default([])

  collection Collection? @relation(fields: [collection_id], references: [id])
  category   Category?   @relation(fields: [category_id], references: [id])
  type       Type?       @relation(fields: [type_id], references: [id])
  
  product_collections ProductCollection[]
  product_categories  ProductCategory[]
  product_types       ProductType[]
  
  variants    Variant[]
  order_items OrderItem[]

  @@index([collection_id])
  @@index([category_id])
  @@index([type_id])
  @@index([is_active])
  @@index([is_featured])
  @@index([slug])
  @@map("products")
  @@schema("public")
}

model ProductCollection {
  product_id    String   @db.Uuid
  collection_id String   @db.Uuid
  display_order Int      @default(0)
  created_at    DateTime @default(now()) @db.Timestamptz(6)

  product    Product    @relation(fields: [product_id], references: [id], onDelete: Cascade)
  collection Collection @relation(fields: [collection_id], references: [id], onDelete: Cascade)

  @@id([product_id, collection_id])
  @@map("product_collections")
  @@schema("public")
}

model ProductCategory {
  product_id  String   @db.Uuid
  category_id String   @db.Uuid
  display_order Int      @default(0)
  created_at  DateTime @default(now()) @db.Timestamptz(6)

  product  Product  @relation(fields: [product_id], references: [id], onDelete: Cascade)
  category Category @relation(fields: [category_id], references: [id], onDelete: Cascade)

  @@id([product_id, category_id])
  @@map("product_categories")
  @@schema("public")
}

model ProductType {
  product_id String   @db.Uuid
  type_id    String   @db.Uuid
  display_order Int      @default(0)
  created_at DateTime @default(now()) @db.Timestamptz(6)

  product Product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  type    Type    @relation(fields: [type_id], references: [id], onDelete: Cascade)

  @@id([product_id, type_id])
  @@map("product_types")
  @@schema("public")
}

model Variant {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  product_id       String   @db.Uuid
  name             String   @db.Text
  sku              String?  @unique @db.Text
  price            Decimal? @db.Decimal(10, 2)
  compare_at_price Decimal? @db.Decimal(10, 2)
  color            String?  @db.Text
  has_blouse       Boolean  @default(false)
  blouse_included  Boolean  @default(false)
  size             String?  @db.Text
  image_url        String?  @db.Text
  stock_quantity   Int      @default(0)
  track_inventory  Boolean  @default(true)
  is_active        Boolean  @default(true)
  display_order    Int      @default(0)
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  updated_at       DateTime @default(now()) @db.Timestamptz(6)

  product     Product     @relation(fields: [product_id], references: [id], onDelete: Cascade)
  inventory   Inventory[]
  order_items OrderItem[]

  @@index([product_id])
  @@index([sku])
  @@index([is_active])
  @@index([stock_quantity])
  @@map("variants")
  @@schema("public")
}

// ============================================
// INVENTORY
// ============================================

model Inventory {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  variant_id       String   @db.Uuid
  quantity_change  Int
  quantity_before  Int
  quantity_after   Int
  type             String   @db.Text // 'purchase', 'sale', 'return', 'adjustment', 'damage', 'transfer'
  order_id         String?  @db.Uuid
  reference_number String?  @db.Text
  notes            String?  @db.Text
  user_id          String?  @db.Uuid
  created_at       DateTime @default(now()) @db.Timestamptz(6)

  variant Variant @relation(fields: [variant_id], references: [id], onDelete: Cascade)

  @@index([variant_id])
  @@index([order_id])
  @@index([type])
  @@index([created_at(sort: Desc)])
  @@map("inventory")
  @@schema("public")
}

// ============================================
// ORDERS
// ============================================

model Order {
  id                     String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_number           String    @unique @db.Text
  user_id                String?   @db.Uuid
  email                  String    @db.Text
  phone                  String?   @db.Text
  shipping_name          String    @db.Text
  shipping_address_line1 String    @db.Text
  shipping_address_line2 String?   @db.Text
  shipping_city          String    @db.Text
  shipping_state         String    @db.Text
  shipping_postal_code   String    @db.Text
  shipping_country       String    @default("India") @db.Text
  billing_name           String?   @db.Text
  billing_address_line1  String?   @db.Text
  billing_address_line2  String?   @db.Text
  billing_city           String?   @db.Text
  billing_state          String?   @db.Text
  billing_postal_code    String?   @db.Text
  billing_country        String?   @db.Text
  subtotal               Decimal   @db.Decimal(10, 2)
  tax_amount             Decimal   @default(0) @db.Decimal(10, 2)
  shipping_amount        Decimal   @default(0) @db.Decimal(10, 2)
  discount_amount        Decimal   @default(0) @db.Decimal(10, 2)
  total_amount           Decimal   @db.Decimal(10, 2)
  payment_status         String    @default("pending") @db.Text // 'pending', 'paid', 'failed', 'refunded'
  payment_method         String?   @db.Text
  payment_transaction_id String?   @db.Text
  status                 String    @default("pending") @db.Text // 'pending', 'confirmed', 'processing', 'shipped', 'delivered', 'cancelled', 'returned'
  tracking_number        String?   @db.Text
  shipped_at             DateTime? @db.Timestamptz(6)
  delivered_at           DateTime? @db.Timestamptz(6)
  customer_notes         String?   @db.Text
  admin_notes            String?   @db.Text
  created_at             DateTime  @default(now()) @db.Timestamptz(6)
  updated_at             DateTime  @default(now()) @db.Timestamptz(6)

  order_items OrderItem[]

  @@index([user_id])
  @@index([order_number])
  @@index([status])
  @@index([payment_status])
  @@index([created_at(sort: Desc)])
  @@map("orders")
  @@schema("public")
}

model OrderItem {
  id                String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id          String   @db.Uuid
  variant_id        String   @db.Uuid
  product_id        String   @db.Uuid
  product_name      String   @db.Text
  variant_name      String?  @db.Text
  sku               String?  @db.Text
  unit_price        Decimal  @db.Decimal(10, 2)
  quantity          Int
  total_price       Decimal  @db.Decimal(10, 2)
  product_image_url String?  @db.Text
  variant_image_url String?  @db.Text
  created_at        DateTime @default(now()) @db.Timestamptz(6)

  order   Order   @relation(fields: [order_id], references: [id], onDelete: Cascade)
  variant Variant @relation(fields: [variant_id], references: [id])
  product Product @relation(fields: [product_id], references: [id])

  @@index([order_id])
  @@index([variant_id])
  @@index([product_id])
  @@map("order_items")
  @@schema("public")
}

// ============================================
// USER PROFILES
// ============================================

model UserProfile {
  id                  String   @id @db.Uuid
  full_name           String?  @db.Text
  phone               String?  @db.Text
  avatar_url          String?  @db.Text
  address_line1       String?  @db.Text
  address_line2       String?  @db.Text
  city                String?  @db.Text
  state               String?  @db.Text
  postal_code         String?  @db.Text
  country             String   @default("India") @db.Text
  email_notifications Boolean  @default(true)
  sms_notifications   Boolean  @default(false)
  is_active           Boolean  @default(true)
  created_at          DateTime @default(now()) @db.Timestamptz(6)
  updated_at          DateTime @default(now()) @db.Timestamptz(6)

  @@map("user_profiles")
  @@schema("public")
}

model HeroSlide {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title         String   @db.Text
  subtitle      String?  @db.Text
  image_url     String   @db.Text
  button_text   String   @default("Shop Now") @db.Text
  button_link   String   @default("/collections/new-arrivals") @db.Text
  display_order Int      @default(0)
  is_active     Boolean  @default(true)
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @default(now()) @db.Timestamptz(6)

  @@index([is_active])
  @@index([display_order])
  @@map("hero_slides")
  @@schema("public")
}

model BlogArticle {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title           String   @db.Text
  slug            String   @unique @db.Text
  excerpt         String?  @db.Text
  content         String?  @db.Text
  author_name     String?  @db.Text
  cover_image_url String?  @db.Text
  is_featured     Boolean  @default(false)
  is_published    Boolean  @default(true)
  status          String   @default("published") @db.Text // 'published', 'draft', 'archived'
  published_at    DateTime @default(now()) @db.Timestamptz(6)
  category        String?  @db.Text
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  updated_at      DateTime @default(now()) @db.Timestamptz(6)

  @@index([is_published])
  @@index([slug])
  @@map("blog_articles")
  @@schema("public")
}

model AnnouncementBar {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  text          String   @db.Text
  link_url      String?  @db.Text
  background_color String @default("#000000") @db.Text
  text_color    String   @default("#ffffff") @db.Text
  is_active     Boolean  @default(false)
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @default(now()) @db.Timestamptz(6)

  @@index([is_active])
  @@map("announcement_bars")
  @@schema("public")
}

model Testimonial {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  customer_name String   @db.Text
  content       String   @db.Text
  rating        Int      @default(5)
  image_url     String?  @db.Text
  is_active     Boolean  @default(true)
  display_order Int      @default(0)
  created_at    DateTime @default(now()) @db.Timestamptz(6)

  @@index([is_active])
  @@map("testimonials")
  @@schema("public")
}

model LandingPageVideo {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title         String   @db.Text
  video_url     String   @db.Text
  thumbnail_url String?  @db.Text
  is_active     Boolean  @default(true)
  display_order Int      @default(0)
  created_at    DateTime @default(now()) @db.Timestamptz(6)

  @@map("landing_page_videos")
  @@schema("public")
}

model LandingPageSection {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  section_key String   @unique @db.Text // e.g., 'hero', 'featured_products'
  is_visible  Boolean  @default(true)
  settings    Json?    @db.Json
  updated_at  DateTime @default(now()) @db.Timestamptz(6)

  @@map("landing_page_sections")
  @@schema("public")
}

model SocialMediaSetting {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  platform      String   @unique @db.Text // facebook, instagram, etc
  url           String   @db.Text
  icon_name     String?  @db.Text
  is_visible    Boolean  @default(true)
  display_order Int      @default(0)

  @@map("social_media_settings")
  @@schema("public")
}
